<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@ortense/mediator</title><meta name="description" content="Documentation for @ortense/mediator"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@ortense/mediator</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>@ortense/mediator</h2></div><div class="tsd-panel tsd-typography"><p><img src="https://raw.githubusercontent.com/ortense/mediator/main/media/mediator.jpg" alt="Mediator banner - the mediator mascot generated by dall-e 2"></p>
<a id="md:ortensemediator" class="tsd-anchor"></a><h1><a href="#md:ortensemediator">@ortense/mediator</a></h1><p><a href="https://bundlephobia.com/package/@ortense/mediator@1.3.0"><img src="https://badgen.net/npm/v/@ortense/mediator" alt="npm version"></a> <a href="https://bundlephobia.com/package/@ortense/mediator@1.3.0"><img src="https://badgen.net/bundlephobia/minzip/@ortense/mediator" alt="bundle size"></a> <a href="https://packagephobia.com/result?p=@ortense/mediator"><img src="https://packagephobia.com/badge?p=@ortense/mediator" alt="install size"></a> <a href="https://coveralls.io/github/ortense/mediator?branch=github-actions"><img src="https://coveralls.io/repos/github/ortense/mediator/badge.svg?branch=github-actions" alt="Coverage Status"></a> <a href="https://jsr.io/@ortense/mediator"><img src="https://jsr.io/badges/@ortense/mediator/score" alt="JSR Score"></a> </p>
<p>A minimalistic and dependency-free event mediator with internal context and middleware support for front-end.
Written typescript for a good development experience and incredibly lightweight at less than 550 bytes!</p>
<p>Access the complete documentation at <a href="https://ortense.github.io/mediator/">ortense.github.io/mediator/</a></p>
<a id="md:use-case" class="tsd-anchor"></a><h2><a href="#md:use-case">Use case</a></h2><p>You want to simplify communication between independent components in your web app. The mediator can be used to facilitate the exchange of data and events between different parts of the application without crate a strong coupling, keeping the separation of concerns between the components of your app or external integrations like third party scripts or extensions.</p>
<p><img src="https://raw.githubusercontent.com/ortense/mediator/main/media/flow.png" alt="Mediator flow chart - made in excalidraw.com"></p>
<a id="md:install" class="tsd-anchor"></a><h2><a href="#md:install">Install</a></h2><p>Pick your favorite package manager.</p>
<pre><code class="language-sh"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">@ortense/mediator</span><span class="hl-1">  </span><span class="hl-3"># npm</span><br/><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1">  </span><span class="hl-2">@ortense/mediator</span><span class="hl-1">    </span><span class="hl-3"># yarn</span><br/><span class="hl-0">pnpm</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">@ortense/mediator</span><span class="hl-1">     </span><span class="hl-3"># pnpm</span><br/><span class="hl-0">bun</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">@ortense/mediator</span><span class="hl-1">      </span><span class="hl-3"># bun</span>
</code><button>Copy</button></pre>
<a id="md:usage" class="tsd-anchor"></a><h2><a href="#md:usage">Usage</a></h2><p>First, define an interface that extends <code>MediatorContext</code> to represent your context, this interface must be an object with properties serializable to JSON.</p>
<pre><code class="language-typescript"><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-6">MyContext</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-6">MediatorContext</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">value</span><span class="hl-1">: </span><span class="hl-6">string</span><br/><span class="hl-1">  </span><span class="hl-7">active</span><span class="hl-1">: </span><span class="hl-6">boolean</span><br/><span class="hl-1">  </span><span class="hl-7">nested</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-7">items</span><span class="hl-1">: </span><span class="hl-6">number</span><span class="hl-1">[]</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Now create an object to be your initial context.</p>
<pre><code class="language-typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">initialContext</span><span class="hl-1">: </span><span class="hl-6">MyContext</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-7">value:</span><span class="hl-1"> </span><span class="hl-2">&#39;hello world&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">active:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">nested:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">items:</span><span class="hl-1"> [],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Then create the mediator object:</p>
<pre><code class="language-typescript"><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">myMediator</span><span class="hl-1"> = </span><span class="hl-0">createMediator</span><span class="hl-1">(</span><span class="hl-7">initialContext</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p>The complete setup file should look like this:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-7">MediatorContext</span><span class="hl-1">, </span><span class="hl-7">createMediator</span><span class="hl-1">, </span><span class="hl-7">MediatorMiddleware</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@ortense/mediator&#39;</span><br/><br/><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-6">MyContext</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-6">MediatorContext</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">value</span><span class="hl-1">: </span><span class="hl-6">string</span><br/><span class="hl-1">  </span><span class="hl-7">active</span><span class="hl-1">: </span><span class="hl-6">boolean</span><br/><span class="hl-1">  </span><span class="hl-7">nested</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-7">items</span><span class="hl-1">: </span><span class="hl-6">number</span><span class="hl-1">[]</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">initialContext</span><span class="hl-1">: </span><span class="hl-6">MyContext</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-7">value:</span><span class="hl-1"> </span><span class="hl-2">&#39;hello world&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">active:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">nested:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">items:</span><span class="hl-1"> [],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">// Optional: Add middleware for logging</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">logger</span><span class="hl-1">: </span><span class="hl-6">MediatorMiddleware</span><span class="hl-1">&lt;</span><span class="hl-6">MyContext</span><span class="hl-1">, </span><span class="hl-6">string</span><span class="hl-1">&gt; = (</span><span class="hl-7">context</span><span class="hl-1">, </span><span class="hl-7">input</span><span class="hl-1">, </span><span class="hl-7">event</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Event </span><span class="hl-5">${</span><span class="hl-7">event</span><span class="hl-5">}</span><span class="hl-2"> triggered with context:`</span><span class="hl-1">, </span><span class="hl-7">context</span><span class="hl-1">)</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">myMediator</span><span class="hl-1"> = </span><span class="hl-0">createMediator</span><span class="hl-1">(</span><span class="hl-7">initialContext</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-7">middlewares:</span><span class="hl-1"> [</span><br/><span class="hl-1">    { </span><span class="hl-7">event:</span><span class="hl-1"> </span><span class="hl-2">&#39;*&#39;</span><span class="hl-1">, </span><span class="hl-7">handler:</span><span class="hl-1"> </span><span class="hl-7">logger</span><span class="hl-1"> }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">})</span>
</code><button>Copy</button></pre>
<a id="md:events" class="tsd-anchor"></a><h3><a href="#md:events">Events</a></h3><p>The mediator use simple strings to identify events, think of it as a unique identifier to be used to send or listen to events.</p>
<p>Optionally, you can define a type that extends from <code>string</code> to represent the events that your mediator has.</p>
<pre><code class="language-typescript"><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-6">MyEvents</span><span class="hl-1"> = </span><span class="hl-2">&#39;loaded&#39;</span><span class="hl-1"> | </span><span class="hl-2">&#39;value:change&#39;</span><span class="hl-1"> | </span><span class="hl-2">&#39;item:added&#39;</span><span class="hl-1"> | </span><span class="hl-2">&#39;item:removed&#39;</span><br/><br/><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">myMediator</span><span class="hl-1"> = </span><span class="hl-0">createMediator</span><span class="hl-1">&lt;</span><span class="hl-6">MyContext</span><span class="hl-1">, </span><span class="hl-6">MyEvents</span><span class="hl-1">&gt;(</span><span class="hl-7">initialContext</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p>This is a good practice to help developers who will interact with the mediator, providing predictability of the events that can be listened or send.</p>
<a id="md:middlewares" class="tsd-anchor"></a><h3><a href="#md:middlewares">Middlewares</a></h3><p>Middlewares provide a powerful way to intercept, transform, and control event flow in your mediator. They execute <strong>before</strong> event listeners and can:</p>
<ul>
<li><strong>Observe events</strong>: Log, track, or monitor events without side effects</li>
<li><strong>Transform data</strong>: Modify pending changes before they&#39;re applied to the context</li>
<li><strong>Validate changes</strong>: Ensure data integrity and business rules</li>
<li><strong>Cancel propagation</strong>: Stop event processing entirely when needed</li>
</ul>
<p>Middlewares are configured during mediator creation and run in the order they&#39;re declared.</p>
<a id="md:creating-a-mediator-with-middlewares" class="tsd-anchor"></a><h4><a href="#md:creating-a-mediator-with-middlewares">Creating a Mediator with Middlewares</a></h4><pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-7">createMediator</span><span class="hl-1">, </span><span class="hl-7">MediatorMiddleware</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@ortense/mediator&#39;</span><br/><br/><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-6">AppContext</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-6">MediatorContext</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">user</span><span class="hl-1">: </span><span class="hl-6">string</span><br/><span class="hl-1">  </span><span class="hl-7">count</span><span class="hl-1">: </span><span class="hl-6">number</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">// Logger middleware (observes only)</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">logEvents</span><span class="hl-1">: </span><span class="hl-6">MediatorMiddleware</span><span class="hl-1">&lt;</span><span class="hl-6">AppContext</span><span class="hl-1">, </span><span class="hl-6">string</span><span class="hl-1">&gt; = (</span><span class="hl-7">context</span><span class="hl-1">, </span><span class="hl-7">input</span><span class="hl-1">, </span><span class="hl-7">event</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`[</span><span class="hl-5">${</span><span class="hl-7">event</span><span class="hl-5">}</span><span class="hl-2">] Context:`</span><span class="hl-1">, </span><span class="hl-7">context</span><span class="hl-1">, </span><span class="hl-2">&#39;Changes:&#39;</span><span class="hl-1">, </span><span class="hl-7">input</span><span class="hl-1">.</span><span class="hl-7">pendingChanges</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-3">// No return - passes through unchanged</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">// Validation middleware</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">validateCount</span><span class="hl-1">: </span><span class="hl-6">MediatorMiddleware</span><span class="hl-1">&lt;</span><span class="hl-6">AppContext</span><span class="hl-1">, </span><span class="hl-6">string</span><span class="hl-1">&gt; = (</span><span class="hl-7">context</span><span class="hl-1">, </span><span class="hl-7">input</span><span class="hl-1">, </span><span class="hl-7">event</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">input</span><span class="hl-1">.</span><span class="hl-7">pendingChanges</span><span class="hl-1"> &amp;&amp; </span><span class="hl-2">&#39;count&#39;</span><span class="hl-1"> </span><span class="hl-5">in</span><span class="hl-1"> </span><span class="hl-7">input</span><span class="hl-1">.</span><span class="hl-7">pendingChanges</span><span class="hl-1"> &amp;&amp; </span><span class="hl-7">input</span><span class="hl-1">.</span><span class="hl-7">pendingChanges</span><span class="hl-1">.</span><span class="hl-7">count</span><span class="hl-1"> &lt; </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">&#39;Invalid count, cancelling event&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1"> { </span><span class="hl-7">cancel:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> } </span><span class="hl-3">// Stop propagation</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-7">input</span><span class="hl-1"> </span><span class="hl-3">// Pass through</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">// Transformation middleware - adds timestamp to all changes</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">addTimestamp</span><span class="hl-1">: </span><span class="hl-6">MediatorMiddleware</span><span class="hl-1">&lt;</span><span class="hl-6">AppContext</span><span class="hl-1">, </span><span class="hl-6">string</span><span class="hl-1">&gt; = (</span><span class="hl-7">context</span><span class="hl-1">, </span><span class="hl-7">input</span><span class="hl-1">, </span><span class="hl-7">event</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">return</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">pendingChanges:</span><span class="hl-1"> { </span><br/><span class="hl-1">      ...(</span><span class="hl-7">input</span><span class="hl-1">.</span><span class="hl-7">pendingChanges</span><span class="hl-1"> ?? {}), </span><br/><span class="hl-1">      </span><span class="hl-7">timestamp:</span><span class="hl-1"> </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() </span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">mediator</span><span class="hl-1"> = </span><span class="hl-0">createMediator</span><span class="hl-1">&lt;</span><span class="hl-6">AppContext</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">  { </span><span class="hl-7">user:</span><span class="hl-1"> </span><span class="hl-2">&#39;anonymous&#39;</span><span class="hl-1">, </span><span class="hl-7">count:</span><span class="hl-1"> </span><span class="hl-9">0</span><span class="hl-1"> },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-7">middlewares:</span><span class="hl-1"> [</span><br/><span class="hl-1">      { </span><span class="hl-7">event:</span><span class="hl-1"> </span><span class="hl-2">&#39;*&#39;</span><span class="hl-1">, </span><span class="hl-7">handler:</span><span class="hl-1"> </span><span class="hl-7">logEvents</span><span class="hl-1"> },           </span><span class="hl-3">// Runs for all events</span><br/><span class="hl-1">      { </span><span class="hl-7">event:</span><span class="hl-1"> </span><span class="hl-2">&#39;counter:decrement&#39;</span><span class="hl-1">, </span><span class="hl-7">handler:</span><span class="hl-1"> </span><span class="hl-7">validateCount</span><span class="hl-1"> },</span><br/><span class="hl-1">      { </span><span class="hl-7">event:</span><span class="hl-1"> </span><span class="hl-2">&#39;counter:increment&#39;</span><span class="hl-1">, </span><span class="hl-7">handler:</span><span class="hl-1"> </span><span class="hl-7">addTimestamp</span><span class="hl-1"> },</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<a id="md:middleware-types" class="tsd-anchor"></a><h4><a href="#md:middleware-types">Middleware Types</a></h4><pre><code class="language-typescript"><span class="hl-3">// Input data passed to middleware functions</span><br/><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-6">MediatorMiddlewareInput</span><span class="hl-1">&lt;</span><span class="hl-6">Context</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-6">MediatorContext</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-7">pendingChanges</span><span class="hl-1">: </span><span class="hl-6">Nullable</span><span class="hl-1">&lt;</span><span class="hl-6">AtLeastOneOf</span><span class="hl-1">&lt;</span><span class="hl-6">Context</span><span class="hl-1">&gt;&gt;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">// Cancel event propagation</span><br/><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-6">MediatorCancelEvent</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-7">cancel</span><span class="hl-1">: </span><span class="hl-6">true</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">// Middleware function signature</span><br/><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-6">MediatorMiddleware</span><span class="hl-1">&lt;</span><span class="hl-6">Context</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-6">MediatorContext</span><span class="hl-1">, </span><span class="hl-6">EventName</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-6">string</span><span class="hl-1"> = </span><span class="hl-6">string</span><span class="hl-1">&gt; = (</span><br/><span class="hl-1">  </span><span class="hl-7">context</span><span class="hl-1">: </span><span class="hl-6">Readonly</span><span class="hl-1">&lt;</span><span class="hl-6">Context</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-7">input</span><span class="hl-1">: </span><span class="hl-6">MediatorMiddlewareInput</span><span class="hl-1">&lt;</span><span class="hl-6">Context</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">  </span><span class="hl-7">event</span><span class="hl-1">: </span><span class="hl-6">EventName</span><span class="hl-1">,</span><br/><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-6">MediatorMiddlewareInput</span><span class="hl-1">&lt;</span><span class="hl-6">Context</span><span class="hl-1">&gt; | </span><span class="hl-6">MediatorCancelEvent</span><span class="hl-1"> | </span><span class="hl-6">void</span>
</code><button>Copy</button></pre>
<a id="md:middleware-return-types" class="tsd-anchor"></a><h4><a href="#md:middleware-return-types">Middleware Return Types</a></h4><pre><code class="language-typescript"><span class="hl-3">// Void middleware - observes only, passes through unchanged</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">logger</span><span class="hl-1">: </span><span class="hl-6">MediatorMiddleware</span><span class="hl-1">&lt;</span><span class="hl-6">AppContext</span><span class="hl-1">, </span><span class="hl-6">string</span><span class="hl-1">&gt; = (</span><span class="hl-7">context</span><span class="hl-1">, </span><span class="hl-7">input</span><span class="hl-1">, </span><span class="hl-7">event</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Event </span><span class="hl-5">${</span><span class="hl-7">event</span><span class="hl-5">}</span><span class="hl-2"> triggered`</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-3">// No return - middleware passes through</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">// Transform middleware - modifies pending changes</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">enrichData</span><span class="hl-1">: </span><span class="hl-6">MediatorMiddleware</span><span class="hl-1">&lt;</span><span class="hl-6">AppContext</span><span class="hl-1">, </span><span class="hl-6">string</span><span class="hl-1">&gt; = (</span><span class="hl-7">context</span><span class="hl-1">, </span><span class="hl-7">input</span><span class="hl-1">, </span><span class="hl-7">event</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">return</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">pendingChanges:</span><span class="hl-1"> { </span><br/><span class="hl-1">      ...(</span><span class="hl-7">input</span><span class="hl-1">.</span><span class="hl-7">pendingChanges</span><span class="hl-1"> ?? {}), </span><br/><span class="hl-1">      </span><span class="hl-7">timestamp:</span><span class="hl-1"> </span><span class="hl-7">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() </span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">// Cancel middleware - stops event processing</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">authGuard</span><span class="hl-1">: </span><span class="hl-6">MediatorMiddleware</span><span class="hl-1">&lt;</span><span class="hl-6">AppContext</span><span class="hl-1">, </span><span class="hl-6">string</span><span class="hl-1">&gt; = (</span><span class="hl-7">context</span><span class="hl-1">, </span><span class="hl-7">input</span><span class="hl-1">, </span><span class="hl-7">event</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">context</span><span class="hl-1">.</span><span class="hl-7">user</span><span class="hl-1"> === </span><span class="hl-2">&#39;anonymous&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1"> { </span><span class="hl-7">cancel:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> } </span><span class="hl-3">// Stop processing</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-7">input</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:execution-flow" class="tsd-anchor"></a><h4><a href="#md:execution-flow">Execution Flow</a></h4><ol>
<li><code>mediator.send(event, modifier)</code> is called</li>
<li>A frozen snapshot of the current context is created</li>
<li>Modifier generates initial <code>pendingChanges</code> if provided</li>
<li>Middlewares execute in registration order:<ul>
<li><strong>Void middlewares</strong> observe and pass through unchanged</li>
<li><strong>Return middlewares</strong> may return modified <code>pendingChanges</code></li>
<li>Any middleware can return <code>{ cancel: true }</code> to stop propagation</li>
<li><strong>All middlewares receive the same immutable context snapshot</strong></li>
</ul>
</li>
<li>Final context is updated with shallow merge of all <code>pendingChanges</code></li>
<li>Event listeners run with the updated context unless propagation was cancelled</li>
</ol>
<a id="md:listening-to-events" class="tsd-anchor"></a><h3><a href="#md:listening-to-events">Listening to events</a></h3><p>To listen to events use the <code>.on</code> method</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-7">myMediator</span><span class="hl-1">, </span><span class="hl-7">MyContext</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;./my-mediator&#39;</span><br/><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">myEventListener</span><span class="hl-1">(</span><span class="hl-7">ctx</span><span class="hl-1">: </span><span class="hl-6">Readonly</span><span class="hl-1">&lt;</span><span class="hl-6">MyContext</span><span class="hl-1">&gt;, </span><span class="hl-7">event</span><span class="hl-1">: </span><span class="hl-6">MyEvents</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">// do what you want</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">myMediator</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;loaded&#39;</span><span class="hl-1">, </span><span class="hl-7">myEventListener</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p>If you prefer you could use the type <code>MediatorEventListener</code></p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-7">MediatorEventListener</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@ortense/mediator&#39;</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-7">myMediator</span><span class="hl-1">, </span><span class="hl-7">MyContext</span><span class="hl-1">, </span><span class="hl-7">MyEvents</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;./my-mediator&#39;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">myEventListener</span><span class="hl-1">: </span><span class="hl-6">MediatorEventListener</span><span class="hl-1">&lt;</span><span class="hl-6">MyContext</span><span class="hl-1">, </span><span class="hl-6">MyEvents</span><span class="hl-1">&gt; = (</span><span class="hl-7">ctx</span><span class="hl-1">, </span><span class="hl-7">event</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">// do what you want</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">myMediator</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;loaded&#39;</span><span class="hl-1">, </span><span class="hl-7">myEventListener</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p>You also use the wildcard <code>*</code> to listen all events.</p>
<pre><code class="language-typescript"><span class="hl-7">myMediator</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;*&#39;</span><span class="hl-1">, (</span><span class="hl-7">ctx</span><span class="hl-1">, </span><span class="hl-7">event</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-7">ctx</span><span class="hl-1">, </span><span class="hl-7">event</span><span class="hl-1">))</span>
</code><button>Copy</button></pre>
<p>Wildcard listeners could be useful for debugging, for example logging whenever an event is triggered.</p>
<pre><code class="language-typescript"><span class="hl-7">myMediator</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;*&#39;</span><span class="hl-1">, (</span><span class="hl-7">ctx</span><span class="hl-1">, </span><span class="hl-7">event</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Event </span><span class="hl-5">${</span><span class="hl-7">event</span><span class="hl-5">}</span><span class="hl-2"> change the context to`</span><span class="hl-1">, </span><span class="hl-7">ctx</span><span class="hl-1">)</span><br/><span class="hl-1">})</span>
</code><button>Copy</button></pre>
<p>To stop use the <code>.off</code> method</p>
<pre><code class="language-typescript"><span class="hl-7">myMediator</span><span class="hl-1">.</span><span class="hl-0">off</span><span class="hl-1">(</span><span class="hl-2">&#39;loaded&#39;</span><span class="hl-1">, </span><span class="hl-7">myEventListener</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<a id="md:send-events" class="tsd-anchor"></a><h3><a href="#md:send-events">Send events</a></h3><p>To send events use the <code>.send</code> method.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-7">myMediator</span><span class="hl-1">} </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;./my-mediator&#39;</span><br/><br/><span class="hl-7">myMediator</span><span class="hl-1">.</span><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">&#39;loaded&#39;</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p>All listener functions for the <code>loaded</code> event will be called in the order they were added to the mediator.</p>
<p>The <code>.send</code> method could receive a function to modifiy the context:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-7">myMediator</span><span class="hl-1">, </span><span class="hl-7">MyContext</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;./my-mediator&#39;</span><br/><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">changeValue</span><span class="hl-1">(</span><span class="hl-7">ctx</span><span class="hl-1">: </span><span class="hl-6">Readonly</span><span class="hl-1">&lt;</span><span class="hl-6">MyContext</span><span class="hl-1">&gt;) {</span><br/><span class="hl-1">  </span><span class="hl-4">return</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">value:</span><span class="hl-1"> </span><span class="hl-2">&#39;new value&#39;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">myMediator</span><span class="hl-1">.</span><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">&#39;value:change&#39;</span><span class="hl-1">, </span><span class="hl-7">changeValue</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p>If you prefer you could use the <code>MediatorContextModifier</code> type.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-7">MediatorContextModifier</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@ortense/mediator&#39;</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-7">myMediator</span><span class="hl-1">, </span><span class="hl-7">MyContext</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;./my-mediator&#39;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">changeValue</span><span class="hl-1">: </span><span class="hl-6">MediatorContextModifier</span><span class="hl-1">&lt;</span><span class="hl-6">MyContext</span><span class="hl-1">&gt; = (</span><span class="hl-7">ctx</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-7">value:</span><span class="hl-1"> </span><span class="hl-2">&#39;new value&#39;</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-7">myMediator</span><span class="hl-1">.</span><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">&#39;value:change&#39;</span><span class="hl-1">, </span><span class="hl-7">changeValue</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p>Or an inline declaration:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-7">myMediator</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;./my-mediator&#39;</span><br/><br/><span class="hl-7">myMediator</span><span class="hl-1">.</span><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">&#39;value:change&#39;</span><span class="hl-1">, (</span><span class="hl-7">ctx</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> ({ ...</span><span class="hl-7">ctx</span><span class="hl-1">, </span><span class="hl-7">active:</span><span class="hl-1"> </span><span class="hl-2">&#39;new value })</span><span class="hl-10">)</span>
</code><button>Copy</button></pre>
<a id="md:get-current-context" class="tsd-anchor"></a><h3><a href="#md:get-current-context">Get current context</a></h3><p>Use the method <code>.getContext</code> to get a readonly version of the current context.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-7">myMediator</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;./my-mediator&#39;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">ctx</span><span class="hl-1"> = </span><span class="hl-7">myMediator</span><span class="hl-1">.</span><span class="hl-0">getContext</span><span class="hl-1">() </span><span class="hl-3">//? Readonly&lt;MyContext&gt;</span>
</code><button>Copy</button></pre>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:ortensemediator"><span>@ortense/mediator</span></a><ul><li><a href="#md:use-case"><span>Use case</span></a></li><li><a href="#md:install"><span>Install</span></a></li><li><a href="#md:usage"><span>Usage</span></a></li><li><ul><li><a href="#md:events"><span>Events</span></a></li><li><a href="#md:middlewares"><span>Middlewares</span></a></li><li><ul><li><a href="#md:creating-a-mediator-with-middlewares"><span>Creating a <wbr/>Mediator with <wbr/>Middlewares</span></a></li><li><a href="#md:middleware-types"><span>Middleware <wbr/>Types</span></a></li><li><a href="#md:middleware-return-types"><span>Middleware <wbr/>Return <wbr/>Types</span></a></li><li><a href="#md:execution-flow"><span>Execution <wbr/>Flow</span></a></li></ul></li><li><a href="#md:listening-to-events"><span>Listening to events</span></a></li><li><a href="#md:send-events"><span>Send events</span></a></li><li><a href="#md:get-current-context"><span>Get current context</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>@ortense/mediator</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>